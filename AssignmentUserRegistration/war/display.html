<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Display Page</title>
<script src="/js/jquery-1.7.2.min.js"></script>
<script src="/js/validation.js"></script>
    <script type="text/javascript" language="javascript">
    	function displayTable() {
    		$.ajax({
			    url: 'getUserDetails',
			    type: 'GET',
			    dataType:'json',
			    success: function (response) {
			        var trHTML = '';
			        $.each(response.userDetails, function (i, item) {
			            trHTML += '<tr><td>' + item.userId + '</td><td>' + item.userName + '</td><td>' + item.email + '</td>';
			            trHTML += '<td>' + item.phoneNo + '</td><td>' + item.address + '</td>';
			            trHTML += '<td><a style="color:blue" id=\"deleteLink_'+ i + '" onclick="deleteUser(this)" >&nbsp;&nbsp; Delete &nbsp;&nbsp;</a></td>';
			            trHTML += '<td><a style="color:blue" id=\"editLink_'+ i + '" onclick="editUser(this)" >&nbsp;&nbsp; Edit &nbsp;&nbsp;</a></td></tr>';
			        });
			        $('#records_table').append(trHTML);
			    }
			});
    	}
    	
    	function deleteUser(aObj) {
    		$("#modifyDetails").hide();
    		var rowNo = aObj.id.split("_")[1];
    		var rowInfo = $('#records_table tr').eq(parseInt(rowNo)+1);
    		var userIdObj = $(rowInfo).find('td:first');
    		if (userIdObj.html() != null && userIdObj.html() != "") {
    			$(aObj).attr("href", "delete?userId="+ userIdObj.html());
    		}
    	}
    	
    	function editUser(aObj) {
    		var rowNo = aObj.id.split("_")[1];
    		var rowInfo = $('#records_table tr').eq(parseInt(rowNo) + 1);
    		
    		$("#modifyDetails").show();
    		var userId = $(rowInfo).find('td:eq(0)').html();
    		$("#modifyDetails #txtUserId").val(userId);
    		$("#modifyDetails #txtName").val($(rowInfo).find('td:eq(1)').html());
    		$("#modifyDetails #txtPhoneNo").val($(rowInfo).find('td:eq(3)').html());
    		$("#modifyDetails #txtEmail").val($(rowInfo).find('td:eq(2)').html());
    		$("#modifyDetails #txtAddress").val($(rowInfo).find('td:eq(4)').html());
    		
    	}
    	
    	function validate() {
      	  if (!allnumeric()) {
      		  return false;
      	  }
      	  
      	  if (!ValidateEmail()) {
      		  return false;
      	  }
        }
    </script>
    
    <style type="text/css">
    #records_table { border:solid 1px; width:50% } 
    #records_table td { border:solid 1px; }

    </style>
    
</head>
<body onload="displayTable()">

<div>
	<a href="index.html"> Home</a>
	<br/>
	<br/>
	<b>User Display Details:</b>
	<br/>
	<br/>
    <table id="records_table" border='1'>
    <tr>
        <th >UserId</th>
        <th>UserName</th>
        <th>Email</th>
        <th>PhoneNo.</th>
        <th>Address</th>
        <th></th>
        <th></th>
    </tr>
</table>
    </div>
    
    <div id="modifyDetails" style="display:none">
	<br/>
	<b>Modify User Details:</b>
	<br/>
	<br/>
	<form method="get" action="modify" onsubmit="return validate();">
    <table>
      <tr></tr>
      
      <tr>
        <td colspan="2" style="font-weight:bold;">UserId:</td>  
        <td><input type="text" name="txtUserId" id="txtUserId" readonly="readonly"></td>        
      </tr>
      
      <tr>
        <td colspan="2" style="font-weight:bold;">Name:</td>  
        <td><input type="text" name="txtName" id="txtName" required="required"></td>        
      </tr>
      
      <tr>
        <td colspan="2" style="font-weight:bold;">Email:</td>  
        <td><input type="text" name="txtEmail" id="txtEmail" required="required" ></td>        
      </tr>
      
      <tr>
        <td colspan="2" style="font-weight:bold;">Phone No.:</td>  
        <td><input type="text" name="txtPhoneNo" id="txtPhoneNo" required="required" ></td>        
      </tr>
      
      <tr>
        <td colspan="2" style="font-weight:bold;">Address:</td>  
        <td><input type="text" name="txtAddress" id="txtAddress"  required="required" ></td>        
      </tr>
      
      <tr>
        <td><input type="submit" value="Modify"/></td>
      </tr>
      <tr></tr>
      <tr></tr>
    </table>
    </form>
    </div>
</body>
</html>